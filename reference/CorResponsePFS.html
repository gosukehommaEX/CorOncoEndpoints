<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Correlation Between Response and PFS in OS-PFS-Response Framework — CorResponsePFS • CorOncoEndpoints</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Correlation Between Response and PFS in OS-PFS-Response Framework — CorResponsePFS"><meta name="description" content="Calculates the correlation coefficient between a binary response endpoint
and progression-free survival (PFS) in the specific context where all three
endpoints (OS, PFS, Response) are modeled together using the Fleischer model
and copula-based dependence. Given a user-specified correlation between OS
and Response, this function predicts the resulting correlation between PFS
and Response."><meta property="og:description" content="Calculates the correlation coefficient between a binary response endpoint
and progression-free survival (PFS) in the specific context where all three
endpoints (OS, PFS, Response) are modeled together using the Fleischer model
and copula-based dependence. Given a user-specified correlation between OS
and Response, this function predicts the resulting correlation between PFS
and Response."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CorOncoEndpoints</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/introduction.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/introduction.html">Introduction to CorOncoEndpoints</a></li>
    <li><a class="dropdown-item" href="../articles/advanced-usage.html">Advanced Usage and Examples</a></li>
    <li><a class="dropdown-item" href="../articles/theoretical-background.html">Theoretical Background</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gosukehommaEX/CorOncoEndpoints"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Correlation Between Response and PFS in OS-PFS-Response Framework</h1>
      <small class="dont-index">Source: <a href="https://github.com/gosukehommaEX/CorOncoEndpoints/blob/main/R/CorResponsePFS.R" class="external-link"><code>R/CorResponsePFS.R</code></a></small>
      <div class="d-none name"><code>CorResponsePFS.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the correlation coefficient between a binary response endpoint
and progression-free survival (PFS) in the specific context where all three
endpoints (OS, PFS, Response) are modeled together using the Fleischer model
and copula-based dependence. Given a user-specified correlation between OS
and Response, this function predicts the resulting correlation between PFS
and Response.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CorResponsePFS</span><span class="op">(</span><span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">hazard_PFS</span>, <span class="va">rho_OS_Response</span>, <span class="va">copula</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>Numeric. The true probability of the binary response endpoint.
Must be between 0 and 1 (exclusive).</p></dd>


<dt id="arg-hazard-os">hazard_OS<a class="anchor" aria-label="anchor" href="#arg-hazard-os"></a></dt>
<dd><p>Numeric. The hazard rate for overall survival (OS).
Must be positive.</p></dd>


<dt id="arg-hazard-pfs">hazard_PFS<a class="anchor" aria-label="anchor" href="#arg-hazard-pfs"></a></dt>
<dd><p>Numeric. The hazard rate for progression-free survival (PFS).
Must be positive and strictly greater than hazard_OS to ensure PFS &lt;= OS.</p></dd>


<dt id="arg-rho-os-response">rho_OS_Response<a class="anchor" aria-label="anchor" href="#arg-rho-os-response"></a></dt>
<dd><p>Numeric. The desired correlation coefficient between
OS and Response. Must be within the feasible range determined by
Fréchet-Hoeffding bounds for the given p.</p></dd>


<dt id="arg-copula">copula<a class="anchor" aria-label="anchor" href="#arg-copula"></a></dt>
<dd><p>Character. The copula family to use for modeling the dependence
between OS and Response. Options are "Clayton" or "Frank".</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric value representing the correlation coefficient between
PFS and Response.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is designed for the specific setting where:</p><ul><li><p>OS ~ Exp(hazard_OS)</p></li>
<li><p>TTP (time to progression) ~ Exp(hazard_TTP) where hazard_TTP = hazard_PFS - hazard_OS</p></li>
<li><p>PFS = min(OS, TTP) ~ Exp(hazard_PFS) (Fleischer model)</p></li>
<li><p>Response is correlated with OS via the specified copula with correlation rho_OS_Response</p></li>
</ul><p>The calculation proceeds in three steps:</p><ol><li><p>Calculate the copula parameter theta from the specified rho_OS_Response
using <code><a href="CopulaParamResponseTTE.html">CopulaParamResponseTTE</a></code></p></li>
<li><p>Define the first partial derivative of the copula function cy(u, v; theta)</p></li>
<li><p>Calculate Corr(PFS, Response) using the formula:
$$\text{Corr}(PFS, Response) = \sqrt{\frac{1-p}{p}} \frac{1}{\lambda_{TTP}} \left[\frac{\lambda_{PFS}}{1-p} \int_0^1 c_y(u, 1-p; \theta) (1-u)^{\lambda_{TTP}/\lambda_{OS}} du - \lambda_{OS}\right]$$</p></li>
</ol><p>where \(\lambda_{TTP} = \lambda_{PFS} - \lambda_{OS}\) and
\(c_y(u, v; \theta) = \frac{\partial C(u, v; \theta)}{\partial u}\)
is the first partial derivative of the copula function.</p>
<p><strong>Key insight</strong>: When generating OS + PFS + Response simultaneously, users
only specify the correlation between OS and Response. The correlation between
PFS and Response is automatically determined by the model structure. This
function calculates what that resulting correlation will be.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><strong>Practical usage</strong>:</p><ul><li><p>In <code><a href="rOncoEndpoints.html">rOncoEndpoints</a></code>, when all three endpoints are generated,
users specify rho_tte_resp which represents the correlation between OS
and Response</p></li>
<li><p>The correlation between PFS and Response is not specified but emerges
from the model structure</p></li>
<li><p>This function predicts what the PFS-Response correlation will be, which
is useful for:
- Trial design and planning
- Understanding the correlation structure among all three endpoints
- Sensitivity analyses
- Power calculations involving PFS</p></li>
</ul><p><strong>Copula families</strong>:</p><ul><li><p>Clayton copula: Exhibits lower tail dependence, cannot model negative
dependence</p></li>
<li><p>Frank copula: Flexible for both positive and negative dependence with
symmetric tail behavior</p></li>
</ul><p><strong>Numerical considerations</strong>:</p><ul><li><p>The function uses numerical integration which may be less accurate for
extreme parameter combinations (e.g., very large hazard ratios)</p></li>
<li><p>Warnings are issued when hazard ratios are extreme or when integration
encounters difficulties</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fleischer, F., Gaschler-Markefski, B., &amp; Bluhmki, E. (2009). A statistical
model for the dependence between progression-free survival and overall
survival. Statistics in Medicine, 28(21), 2669-2686.</p>
<p>Trivedi, P. K., &amp; Zimmer, D. M. (2005). Copula modeling: an introduction
for practitioners. Foundations and Trends in Econometrics, 1(1), 1-111.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="CopulaParamResponseTTE.html">CopulaParamResponseTTE</a></code> for computing copula parameters,
<code><a href="CorBoundResponseTTE.html">CorBoundResponseTTE</a></code> for general TTE-Response correlation bounds,
<code><a href="CorBoundResponsePFS.html">CorBoundResponsePFS</a></code> for theoretical bounds of PFS-Response correlation,
<code><a href="rOncoEndpoints.html">rOncoEndpoints</a></code> for generating correlated oncology endpoints</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example 1: Calculate PFS-Response correlation given OS-Response correlation</span></span></span>
<span class="r-in"><span><span class="co"># Median OS = 30 months, Median PFS = 18 months</span></span></span>
<span class="r-in"><span><span class="co"># Response rate = 40%, OS-Response correlation = 0.3</span></span></span>
<span class="r-in"><span><span class="va">rho_pfs_resp</span> <span class="op">&lt;-</span> <span class="fu">CorResponsePFS</span><span class="op">(</span></span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="fl">0.4</span>,</span></span>
<span class="r-in"><span>  hazard_OS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>  hazard_PFS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">18</span>,</span></span>
<span class="r-in"><span>  rho_OS_Response <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>  copula <span class="op">=</span> <span class="st">"Clayton"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"PFS-Response correlation:"</span>, <span class="va">rho_pfs_resp</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PFS-Response correlation: 0.2378192 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2: Compare correlations for different copulas</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">hazard_OS</span> <span class="op">&lt;-</span> <span class="fl">0.04</span></span></span>
<span class="r-in"><span><span class="va">hazard_PFS</span> <span class="op">&lt;-</span> <span class="fl">0.08</span></span></span>
<span class="r-in"><span><span class="va">rho_OS</span> <span class="op">&lt;-</span> <span class="fl">0.25</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rho_pfs_clayton</span> <span class="op">&lt;-</span> <span class="fu">CorResponsePFS</span><span class="op">(</span><span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">hazard_PFS</span>, <span class="va">rho_OS</span>, <span class="st">"Clayton"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rho_pfs_frank</span> <span class="op">&lt;-</span> <span class="fu">CorResponsePFS</span><span class="op">(</span><span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">hazard_PFS</span>, <span class="va">rho_OS</span>, <span class="st">"Frank"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Clayton copula - PFS-Response correlation:"</span>, <span class="va">rho_pfs_clayton</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Clayton copula - PFS-Response correlation: 0.1869128 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Frank copula - PFS-Response correlation:"</span>, <span class="va">rho_pfs_frank</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Frank copula - PFS-Response correlation: 0.1676352 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3: Sensitivity analysis - how does PFS-Response correlation</span></span></span>
<span class="r-in"><span><span class="co"># change with different OS-Response correlations?</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span></span>
<span class="r-in"><span><span class="va">hazard_OS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">30</span></span></span>
<span class="r-in"><span><span class="va">hazard_PFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">18</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate feasible range for OS-Response correlation</span></span></span>
<span class="r-in"><span><span class="va">rho_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="CorBoundResponseTTE.html">CorBoundResponseTTE</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For Clayton copula: use only positive correlations</span></span></span>
<span class="r-in"><span><span class="va">rho_OS_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="va">rho_bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.05</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate corresponding PFS-Response correlations</span></span></span>
<span class="r-in"><span><span class="va">rho_PFS_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rho_OS_seq</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rho</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">CorResponsePFS</span><span class="op">(</span><span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">hazard_PFS</span>, <span class="va">rho</span>, copula <span class="op">=</span> <span class="st">"Clayton"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot the relationship</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rho_OS_seq</span>, <span class="va">rho_PFS_seq</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Correlation: OS-Response"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Correlation: PFS-Response"</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"Relationship between OS-Response and PFS-Response Correlations"</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rho_OS_seq</span>, <span class="va">rho_PFS_seq</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>  <span class="co"># Identity line</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, </span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFS-Response"</span>, <span class="st">"Identity line (for reference)"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"gray"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CorResponsePFS-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 4: Effect of hazard ratio on PFS-Response correlation</span></span></span>
<span class="r-in"><span><span class="co"># Fix OS-Response correlation, vary PFS hazard</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">hazard_OS</span> <span class="op">&lt;-</span> <span class="fl">0.04</span></span></span>
<span class="r-in"><span><span class="va">rho_OS</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span><span class="va">hazard_PFS_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.06</span>, <span class="fl">0.15</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rho_PFS_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">hazard_PFS_vec</span>, <span class="kw">function</span><span class="op">(</span><span class="va">h_pfs</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">CorResponsePFS</span><span class="op">(</span><span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">h_pfs</span>, <span class="va">rho_OS</span>, copula <span class="op">=</span> <span class="st">"Clayton"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot</span></span></span>
<span class="r-in"><span><span class="va">hazard_ratio</span> <span class="op">&lt;-</span> <span class="va">hazard_PFS_vec</span> <span class="op">/</span> <span class="va">hazard_OS</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hazard_ratio</span>, <span class="va">rho_PFS_vec</span>, type <span class="op">=</span> <span class="st">"b"</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="st">"Hazard Ratio (PFS/OS)"</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Correlation"</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span> <span class="st">"Effect of Hazard Ratio on PFS-Response Correlation"</span>,</span></span>
<span class="r-in"><span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rho_PFS_vec</span>, <span class="va">rho_OS</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">rho_OS</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span></span>
<span class="r-in"><span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFS-Response correlation"</span>, </span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"OS-Response correlation ("</span>, <span class="va">rho_OS</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CorResponsePFS-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 5: Verify calculated correlation matches simulation</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span></span>
<span class="r-in"><span><span class="va">hazard_OS</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span></span>
<span class="r-in"><span><span class="va">hazard_PFS</span> <span class="op">&lt;-</span> <span class="fl">0.08</span></span></span>
<span class="r-in"><span><span class="va">rho_OS_Response</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Predict PFS-Response correlation</span></span></span>
<span class="r-in"><span><span class="va">predicted_rho</span> <span class="op">&lt;-</span> <span class="fu">CorResponsePFS</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">p</span>, <span class="va">hazard_OS</span>, <span class="va">hazard_PFS</span>, <span class="va">rho_OS_Response</span>, copula <span class="op">=</span> <span class="st">"Clayton"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate data and calculate empirical correlation</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="rOncoEndpoints.html">rOncoEndpoints</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  nsim <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  hazard_OS <span class="op">=</span> <span class="va">hazard_OS</span>,</span></span>
<span class="r-in"><span>  hazard_PFS <span class="op">=</span> <span class="va">hazard_PFS</span>,</span></span>
<span class="r-in"><span>  rho_tte_resp <span class="op">=</span> <span class="va">rho_OS_Response</span>,</span></span>
<span class="r-in"><span>  copula <span class="op">=</span> <span class="st">"Clayton"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">empirical_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">PFS</span>, <span class="va">data</span><span class="op">$</span><span class="va">Response</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Predicted PFS-Response correlation:"</span>, <span class="va">predicted_rho</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Empirical PFS-Response correlation:"</span>, <span class="va">empirical_rho</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Difference:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">predicted_rho</span> <span class="op">-</span> <span class="va">empirical_rho</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gosuke Homma</p>
</div>

<div class="pkgdown-footer-right">
  <p>Built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>.</p>
</div>

    </footer></div>





  </body></html>

